machine:
  python:
    version: 2.7.11
  post:
    - "curl -v -L -o cf-cli_amd64.deb 'https://cli.run.pivotal.io/stable?release=debian64&version=6.17.0&source=github'"
    - sudo dpkg -i cf-cli_amd64.deb
    - cf -v

dependencies:
  override:
    - pip install mkdocs

test:
  override:
    - mkdocs build

deployment:
  production:
    branch: /.*/
    commands:
      - if [[ -n ${CF_BASIC_AUTH_PASSWORD+x} ]]; then htpasswd -cb _site/Staticfile.auth $CF_BASIC_AUTH_USERNAME $CF_BASIC_AUTH_PASSWORD; else echo "Not setting a password"; fi
      - cf api $CF_API
      - cf auth $CF_USER $CF_PASSWORD
      - cf target -o $CF_ORG
      - cf target -s $CF_SPACE
      - cf push cgadocs-$CIRCLE_BRANCH
